<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>memcached: slabs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>slabs.c File Reference</h1><code>#include &quot;<a class="el" href="memcached_8h-source.html">memcached.h</a>&quot;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;sys/signal.h&gt;</code><br>
<code>#include &lt;sys/resource.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;assert.h&gt;</code><br>
<code>#include &lt;pthread.h&gt;</code><br>

<p>
<div class="dynheader">
Include dependency graph for slabs.c:</div>
<div class="dynsection">
<p><center><img src="slabs_8c__incl.png" border="0" usemap="#slabs.c_map" alt=""></center>
<map name="slabs.c_map">
<area shape="rect" id="node3" href="memcached_8h.html" title="The main memcached header holding commonly used data structures and function prototypes..." alt="" coords="756,83,873,112"><area shape="rect" id="node23" href="protocol__binary_8h.html" title="protocol_binary.h" alt="" coords="1245,160,1379,189"><area shape="rect" id="node26" href="stats_8h.html" title="stats.h" alt="" coords="1453,160,1523,189"><area shape="rect" id="node28" href="slabs_8h.html" title="slabs.h" alt="" coords="1547,160,1613,189"><area shape="rect" id="node30" href="assoc_8h.html" title="assoc.h" alt="" coords="256,160,328,189"><area shape="rect" id="node32" href="items_8h.html" title="items.h" alt="" coords="352,160,424,189"><area shape="rect" id="node34" href="trace_8h.html" title="trace.h" alt="" coords="448,160,517,189"><area shape="rect" id="node36" href="hash_8h.html" title="hash.h" alt="" coords="541,160,605,189"><area shape="rect" id="node38" href="util_8h.html" title="util.h" alt="" coords="629,160,683,189"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structslabclass__t.html">slabclass_t</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#89e035684df4bb1ef8b0852cb2c20f00">slabs_clsid</a> (const size_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Given object size, return id to use when allocating/freeing memory for object 0 means error: can't store such a large object.  <a href="#89e035684df4bb1ef8b0852cb2c20f00"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#8cc4ad6521988a6806c2600bd2f2010b">slabs_init</a> (const size_t limit, const double factor, const bool prealloc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determines the chunk sizes and initializes the slab class descriptors accordingly.  <a href="#8cc4ad6521988a6806c2600bd2f2010b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#0e8837809ec40b8024ca6f972830176c">get_stats</a> (const char *stat_type, int nkey, <a class="el" href="memcached_8h.html#b8d9bd9ba0b7b765633bf9b6cbd6aa30">ADD_STAT</a> add_stats, void *c)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a datum for <a class="el" href="structstats.html" title="Global stats.">stats</a> in binary protocol.  <a href="#0e8837809ec40b8024ca6f972830176c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#f71fcc67d3024b6d57945de6215fa421">slabs_alloc</a> (size_t size, unsigned int id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate object of given length.  <a href="#f71fcc67d3024b6d57945de6215fa421"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#870e49205e3adc320d078b03d8ea3b23">slabs_free</a> (void *ptr, size_t size, unsigned int id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free previously allocated object.  <a href="#870e49205e3adc320d078b03d8ea3b23"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="slabs_8c.html#0d52f605d063c6de9e3f32e08126915c">slabs_stats</a> (<a class="el" href="memcached_8h.html#b8d9bd9ba0b7b765633bf9b6cbd6aa30">ADD_STAT</a> add_stats, void *c)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fill buffer with <a class="el" href="structstats.html" title="Global stats.">stats</a>.  <a href="#0d52f605d063c6de9e3f32e08126915c"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0e8837809ec40b8024ca6f972830176c"></a><!-- doxytag: member="slabs.c::get_stats" ref="0e8837809ec40b8024ca6f972830176c" args="(const char *stat_type, int nkey, ADD_STAT add_stats, void *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool get_stats           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>stat_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nkey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="memcached_8h.html#b8d9bd9ba0b7b765633bf9b6cbd6aa30">ADD_STAT</a>&nbsp;</td>
          <td class="paramname"> <em>add_stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return a datum for <a class="el" href="structstats.html" title="Global stats.">stats</a> in binary protocol. 
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_0e8837809ec40b8024ca6f972830176c_cgraph.png" border="0" usemap="#slabs_8c_0e8837809ec40b8024ca6f972830176c_cgraph_map" alt=""></center>
<map name="slabs_8c_0e8837809ec40b8024ca6f972830176c_cgraph_map">
<area shape="rect" id="node3" href="memcached_8h.html#2b022c04b5ceac327d82762206f51ca8" title="item_stats" alt="" coords="163,5,259,35"><area shape="rect" id="node7" href="memcached_8h.html#76a67af22fe6ce802c07e857f06cbdc8" title="item_stats_sizes" alt="" coords="143,59,279,88"><area shape="rect" id="node11" href="slabs_8c.html#0d52f605d063c6de9e3f32e08126915c" title="Fill buffer with stats." alt="" coords="163,112,259,141"><area shape="rect" id="node5" href="items_8c.html#c37d9c76fff27f10050dc069eef7d50c" title="do_item_stats" alt="" coords="348,5,468,35"><area shape="rect" id="node9" href="items_8c.html#83d27e539e6256fe75653def1f4594e3" title="dumps out a list of objects of each size, with granularity of 32 bytes" alt="" coords="328,59,488,88"></map>
</div>

</div>
</div><p>
<a class="anchor" name="f71fcc67d3024b6d57945de6215fa421"></a><!-- doxytag: member="slabs.c::slabs_alloc" ref="f71fcc67d3024b6d57945de6215fa421" args="(size_t size, unsigned int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* slabs_alloc           </td>
          <td>(</td>
          <td class="paramtype">const size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate object of given length. 
<p>
0 on error 
<p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_f71fcc67d3024b6d57945de6215fa421_icgraph.png" border="0" usemap="#slabs_8c_f71fcc67d3024b6d57945de6215fa421_icgraph_map" alt=""></center>
<map name="slabs_8c_f71fcc67d3024b6d57945de6215fa421_icgraph_map">
<area shape="rect" id="node3" href="items_8h.html#5b94ba56566ec70ae2a1906e1b6b14ae" title="do_item_alloc" alt="" coords="148,59,260,88"><area shape="rect" id="node5" href="memcached_8h.html#72e74041ab741435d161a044d23d0bef" title="do_add_delta" alt="" coords="315,5,424,35"><area shape="rect" id="node9" href="memcached_8h.html#c2e150055051a36e29e8215f5bc35fca" title="do_store_item" alt="" coords="309,59,429,88"><area shape="rect" id="node13" href="thread_8c.html#d69cc14d059b72c07e1f0b550b1922c6" title="item_alloc" alt="" coords="324,112,415,141"><area shape="rect" id="node7" href="thread_8c.html#4b4951c73b23897aee5843fb7306e764" title="add_delta" alt="" coords="481,5,569,35"><area shape="rect" id="node11" href="thread_8c.html#c97ce2cadaeb4fe6524c0df01828c232" title="store_item" alt="" coords="477,59,573,88"></map>
</div>

</div>
</div><p>
<a class="anchor" name="89e035684df4bb1ef8b0852cb2c20f00"></a><!-- doxytag: member="slabs.c::slabs_clsid" ref="89e035684df4bb1ef8b0852cb2c20f00" args="(const size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int slabs_clsid           </td>
          <td>(</td>
          <td class="paramtype">const size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Given object size, return id to use when allocating/freeing memory for object 0 means error: can't store such a large object. 
<p>

<p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_89e035684df4bb1ef8b0852cb2c20f00_icgraph.png" border="0" usemap="#slabs_8c_89e035684df4bb1ef8b0852cb2c20f00_icgraph_map" alt=""></center>
<map name="slabs_8c_89e035684df4bb1ef8b0852cb2c20f00_icgraph_map">
<area shape="rect" id="node3" href="items_8h.html#5b94ba56566ec70ae2a1906e1b6b14ae" title="do_item_alloc" alt="" coords="145,59,257,88"><area shape="rect" id="node15" href="items_8h.html#9f56df307b2406f372e918860b07adad" title="Returns true if an item will fit in the cache (its size does not exceed the maximum..." alt="" coords="147,112,256,141"><area shape="rect" id="node5" href="memcached_8h.html#72e74041ab741435d161a044d23d0bef" title="do_add_delta" alt="" coords="312,5,421,35"><area shape="rect" id="node9" href="memcached_8h.html#c2e150055051a36e29e8215f5bc35fca" title="do_store_item" alt="" coords="307,59,427,88"><area shape="rect" id="node13" href="thread_8c.html#d69cc14d059b72c07e1f0b550b1922c6" title="item_alloc" alt="" coords="321,112,412,141"><area shape="rect" id="node7" href="thread_8c.html#4b4951c73b23897aee5843fb7306e764" title="add_delta" alt="" coords="479,5,567,35"><area shape="rect" id="node11" href="thread_8c.html#c97ce2cadaeb4fe6524c0df01828c232" title="store_item" alt="" coords="475,59,571,88"></map>
</div>

</div>
</div><p>
<a class="anchor" name="870e49205e3adc320d078b03d8ea3b23"></a><!-- doxytag: member="slabs.c::slabs_free" ref="870e49205e3adc320d078b03d8ea3b23" args="(void *ptr, size_t size, unsigned int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slabs_free           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free previously allocated object. 
<p>

<p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_870e49205e3adc320d078b03d8ea3b23_icgraph.png" border="0" usemap="#slabs_8c_870e49205e3adc320d078b03d8ea3b23_icgraph_map" alt=""></center>
<map name="slabs_8c_870e49205e3adc320d078b03d8ea3b23_icgraph_map">
<area shape="rect" id="node3" href="items_8h.html#5305dd637fb32e9a99b97326de1429eb" title="item_free" alt="" coords="144,59,232,88"><area shape="rect" id="node5" href="items_8h.html#81d7ffedc021b4a576d5712b7cea34a7" title="do_item_remove" alt="" coords="676,5,812,35"><area shape="rect" id="node17" href="items_8h.html#8068353af89272b21fbf0bd88d34118b" title="may fail if transgresses limits" alt="" coords="280,137,400,167"><area shape="rect" id="node7" href="memcached_8h.html#72e74041ab741435d161a044d23d0bef" title="do_add_delta" alt="" coords="872,216,981,245"><area shape="rect" id="node11" href="memcached_8h.html#c2e150055051a36e29e8215f5bc35fca" title="do_store_item" alt="" coords="867,137,987,167"><area shape="rect" id="node15" href="thread_8c.html#5674d2ce2742470b8012fa4184f1fc3b" title="item_remove" alt="" coords="871,5,983,35"><area shape="rect" id="node9" href="thread_8c.html#4b4951c73b23897aee5843fb7306e764" title="add_delta" alt="" coords="1039,216,1127,245"><area shape="rect" id="node13" href="thread_8c.html#c97ce2cadaeb4fe6524c0df01828c232" title="store_item" alt="" coords="1035,137,1131,167"><area shape="rect" id="node19" href="items_8h.html#5b94ba56566ec70ae2a1906e1b6b14ae" title="do_item_alloc" alt="" coords="688,269,800,299"><area shape="rect" id="node25" href="items_8h.html#515ef8e7f0cef67772989fd076f7dcb4" title="do_item_flush_expired" alt="" coords="449,111,620,140"><area shape="rect" id="node29" href="items_8h.html#cee9fa57d05e04e8965f3e19dc0a472c" title="wrapper around assoc_find which does the lazy expiration logic" alt="" coords="481,57,588,87"><area shape="rect" id="node34" href="items_8h.html#cd5e21c19f9875e0d6a74943f90b6cc8" title="update LRU time to current and reposition" alt="" coords="468,217,601,247"><area shape="rect" id="node40" href="thread_8c.html#256717f932dae6220d67fa02af2266bc" title="item_unlink" alt="" coords="487,164,583,193"><area shape="rect" id="node23" href="thread_8c.html#d69cc14d059b72c07e1f0b550b1922c6" title="item_alloc" alt="" coords="881,269,972,299"><area shape="rect" id="node27" href="thread_8c.html#84097b43e7999f753c11603eff36dadc" title="item_flush_expired" alt="" coords="671,163,817,192"><area shape="rect" id="node32" href="thread_8c.html#1ff584f7053e4a5c8f2cffc7186a12aa" title="item_get" alt="" coords="703,59,785,88"><area shape="rect" id="node36" href="thread_8c.html#32cd7e1744d2214e26f0ac267403314e" title="item_replace" alt="" coords="689,216,799,245"></map>
</div>

</div>
</div><p>
<a class="anchor" name="8cc4ad6521988a6806c2600bd2f2010b"></a><!-- doxytag: member="slabs.c::slabs_init" ref="8cc4ad6521988a6806c2600bd2f2010b" args="(const size_t limit, const double factor, const bool prealloc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slabs_init           </td>
          <td>(</td>
          <td class="paramtype">const size_t&nbsp;</td>
          <td class="paramname"> <em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&nbsp;</td>
          <td class="paramname"> <em>prealloc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Determines the chunk sizes and initializes the slab class descriptors accordingly. 
<p>
Init the subsystem. 
<p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_8cc4ad6521988a6806c2600bd2f2010b_icgraph.png" border="0" usemap="#slabs_8c_8cc4ad6521988a6806c2600bd2f2010b_icgraph_map" alt=""></center>
<map name="slabs_8c_8cc4ad6521988a6806c2600bd2f2010b_icgraph_map">
<area shape="rect" id="node3" href="memcached_8c.html#3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="136,5,189,35"></map>
</div>

</div>
</div><p>
<a class="anchor" name="0d52f605d063c6de9e3f32e08126915c"></a><!-- doxytag: member="slabs.c::slabs_stats" ref="0d52f605d063c6de9e3f32e08126915c" args="(ADD_STAT add_stats, void *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slabs_stats           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="memcached_8h.html#b8d9bd9ba0b7b765633bf9b6cbd6aa30">ADD_STAT</a>&nbsp;</td>
          <td class="paramname"> <em>add_stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fill buffer with <a class="el" href="structstats.html" title="Global stats.">stats</a>. 
<p>

<p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<p><center><img src="slabs_8c_0d52f605d063c6de9e3f32e08126915c_icgraph.png" border="0" usemap="#slabs_8c_0d52f605d063c6de9e3f32e08126915c_icgraph_map" alt=""></center>
<map name="slabs_8c_0d52f605d063c6de9e3f32e08126915c_icgraph_map">
<area shape="rect" id="node3" href="slabs_8h.html#0e8837809ec40b8024ca6f972830176c" title="Return a datum for stats in binary protocol." alt="" coords="152,5,240,35"></map>
</div>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Apr 17 15:14:54 2009 for memcached by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
